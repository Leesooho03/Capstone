package com.hy.capstone.project;

import java.util.List;

import javax.servlet.http.HttpServletRequest;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;

import com.hy.capstone.PagingVO;

@Controller
public class ProjectController {
    @Autowired
    private ProjectService projectService;

    @RequestMapping(value = "/projectList.do")
    public String projectList(ModelMap model, HttpServletRequest request) throws Exception {
        String pgParam = request.getParameter("pg");
        int pg = pgParam != null ? Integer.parseInt(pgParam) : 1; // 페이지 번호, 기본값은 1
        int recordCountPerPage = 10; // 페이지당 레코드 수
        
        // 검색 조건 받아오기
        String searchFlag = request.getParameter("search_flg");
        String searchKeyword = request.getParameter("search");

        // 전체 레코드 수 가져오기
        int totalRecordCount = projectService.getTotalProjectCount(searchFlag, searchKeyword);
        // 전체 페이지 수 계산
        int totalPageCount = (int) Math.ceil((double) totalRecordCount / recordCountPerPage);

        // 현재 페이지에서 보여줄 레코드의 시작 인덱스
        int startIdx = (pg - 1) * recordCountPerPage;

        // 프로젝트 리스트 가져오기
        List<ProjectVO> projectList = projectService.getProjectList(startIdx, recordCountPerPage, searchFlag, searchKeyword);

        model.addAttribute("projectList", projectList);
        model.addAttribute("pg", pg);
        model.addAttribute("totalRecordCount", totalRecordCount);
        model.addAttribute("totalPageCount", totalPageCount);
        model.addAttribute("startIdx", startIdx);

        return "/projectList";
    }
}

